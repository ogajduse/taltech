! Router R3
en
conf t
hostname R3
no ip domain-lookup

int g0/0
ip address 192.168.13.1 255.255.255.0
no shutdown
exit

int g0/1
ip address 192.168.3.1 255.255.255.0
no shut
exit

int s0/0/1
ip address 10.2.2.1 255.255.255.0
no shut
exit

router ospf 1
network 10.2.2.0 0.0.0.255 area 0
network 192.168.13.0 0.0.0.255 area 0
network 192.168.3.0 0.0.0.255 area 0
exit

security passwords min-length 10
ip domain-name ccnasecurity.com

crypto key generate rsa general-keys modulus 1024

username cisco algorithm-type scrypt secret cisco12345

line vty 0 4
login local
transport input ssh
exec-timeout 5 0
exit




!Lan SSH permission to router
access-list 102 permit tcp host 192.168.3.10 host 192.168.3.1 eq 22 log
access-list 102 permit tcp host 192.168.3.10 host 10.2.2.1 eq 22 log
access-list 102 permit tcp any any eq 80 log
access-list 102 permit tcp any any eq 443 log
access-list 102 permit tcp any any eq 21 log
access-list 102 permit ip host 192.168.3.10 any log


int g0/1
ip access-group 102 in


!no ssh to router from another router
access-list 106 deny tcp any host 192.168.3.1 eq 22 log
access-list 106 deny tcp any host 192.168.13.1 eq 22 log
access-list 106 deny tcp any host 10.2.2.1 eq 22 log
access-list 106 permit ip any any


int s0/0/1
ip access-group 106 in


!no dmz to router (SSH)
access-list 105 deny tcp any host 192.168.3.1 eq 22 log
access-list 105 deny tcp any host 192.168.13.1 eq 22 log
access-list 105 deny tcp any host 10.2.2.1 eq 22 log
!access-list 105 permit ip any any


!deny connection initiation to lan
!access-list 105 permit tcp host 192.168.13.1 host 192.168.3.1 established
!access-list 105 permit ip host 192.168.3.1 host 192.168.13.1
!access-list 105 deny ip host 192.168.13.1 host 192.168.3.1
access-list 105 permit tcp any any established log
access-list 105 deny tcp host 192.168.13.1 any eq 80 log
access-list 105 deny tcp host 192.168.13.1 any eq 443 log
access-list 105 permit tcp any host 192.168.13.1 eq 80 log
access-list 105 permit tcp any host 192.168.13.1 eq 443 log

access-list 105 permit udp any any eq domain log
access-list 105 permit udp any eq domain any log
access-list 105 permit tcp any any eq domain log
access-list 105 permit tcp any eq domain any log

access-list 105 permit tcp any any eq smtp log
!access-list 105 permit ip any any log

!dmz

int g0/0
ip access-group 105 in


!Probably have to rework this part. We are on part 6 (donÂ´t forget to blacklist twitter as well)
!To block internet to initiate connections with us, maybe replace tcp by ip
!access-list 107 deny tcp any any log
!int s0/0/1
!ip access-group 107 out